

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Image Manipulate &mdash; FRED Tools 0.6.9 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Display Image" href="displayImage.html" />
    <link rel="prev" title="Getting Subimage" href="GettingSubimage.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #00007fff" >
          

          
            <a href="../index.html" class="icon icon-home"> FRED Tools
          

          
            
            <img src="../_static/FREDtools_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.6.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../Introduction/Collaboration.html">Collaboration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Introduction/Citation.html">Citation and References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ReadWrite.html">Image Reading and Writing</a></li>
<li class="toctree-l1"><a class="reference internal" href="ImageAnalyse.html">Image Analyse</a></li>
<li class="toctree-l1"><a class="reference internal" href="dvhAnalyse.html">DVH Analyse</a></li>
<li class="toctree-l1"><a class="reference internal" href="braggPeakAnalyse.html">Bragg Peak Analyse</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingSubimage.html">Getting Subimage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Image Manipulate</a></li>
<li class="toctree-l1"><a class="reference internal" href="displayImage.html">Display Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="simTools.html">Monte Carlo simulation tools</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">FRED Tools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Image Manipulate</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/Documentation/ImageManipulate.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="image-manipulate">
<h1>Image Manipulate<a class="headerlink" href="#image-manipulate" title="Permalink to this headline">¶</a></h1>
<p>A collection of useful functions to manipulate and change images. The image must be an instance of a SimpleITK image and the functions are mostly wrappers for SimpleITK image filters. Check <a class="reference external" href="https://simpleitk.readthedocs.io/en/master/filters.html">SimpleITK filters</a> for available methods of filtering, registration, etc.</p>
<dl class="py function">
<dt class="sig sig-object py" id="fredtools.mapStructToImg">
<span class="sig-prename descclassname"><span class="pre">fredtools.</span></span><span class="sig-name descname"><span class="pre">mapStructToImg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">RSfileName</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">structName</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'centreInside'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">algorithm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'smparallel'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">CPUNo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">displayInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fredtools.mapStructToImg" title="Permalink to this definition">¶</a></dt>
<dd><p>Map structure to image and create a mask.</p>
<p>The function reads a <cite>structName</cite> structure from RS dicom file and maps it to
the frame of reference of <cite>img</cite> defined a SimpleITK image object. The created
mask is an image with the same frame of reference (origin. spacing, direction
and size) as the <cite>img</cite> with voxels inside the contour and 0 outside. It is
assumed that the image is 3D and  has an unitary direction, which means that
the axes describe X,Y and Z directions, respectively. The frame of reference
of the <cite>img</cite> is not specified, in particular, the Z-spacing does not have to
be the same as the structure Z-spacing.</p>
<p>Two methods of mapping voxels are available of are available: ‘allinside’, which
maps the voxels which are all inside the contour (including voxel size and edges),
and ‘centreInside’ (default method), which maps only the centre of the voxels.</p>
<p>Two algorithms of mapping are available: ‘matplotlib’, which utilizes the
matplotlib.path.Path.contains_points functionality, and ‘smparallel’, which exploits
the algorithm described in <a class="footnote-reference brackets" href="#id5" id="id1">1</a>.</p>
<p>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>SimpleITK Image</em>) – Object of a SimpleITK 3D image.</p></li>
<li><p><strong>RSfileName</strong> (<em>string</em>) – Path String to dicom file with structures (RS file).</p></li>
<li><p><strong>structName</strong> (<em>string</em>) – Name of the structure to be mapped.</p></li>
<li><p><strong>method</strong> (<em>{'centreInside'</em><em>, </em><em>'allInside'}</em><em>, </em><em>optional</em>) – <p>Method of calculation (def. ‘centreInside’):</p>
<blockquote>
<div><ul>
<li><p>’centreInside’ : map the voxels which are all inside the contour.</p></li>
<li><p>’allInside’ : map only the centre of the voxels.</p></li>
</ul>
</div></blockquote>
</p></li>
<li><p><strong>algorithm</strong> (<em>{'smparallel'</em><em>, </em><em>'matplotlib'}</em><em>, </em><em>optional</em>) – <p>Algorithm of calculation (def. ‘smparallel’):</p>
<blockquote>
<div><ul>
<li><p>’smparallel’ : use matplotlib to calculate the voxels inside contours.</p></li>
<li><p>’matplotlib’ : use multiprocessing sm algorithm to calculate the voxels inside contours.</p></li>
</ul>
</div></blockquote>
</p></li>
<li><p><strong>CPUNo</strong> (<em>{'auto'</em><em>, </em><em>'none'}</em><em>, </em><em>scalar</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – Define if the multiprocessing should be used and how many cores should
be exploited. Can be None, then no multiprocessing will be used,
a string ‘auto’, then the number of cores will be determined by os.cpu_count(),
or a scalar defining the number of CPU cored to be used. (def. ‘auto’)</p></li>
<li><p><strong>displayInfo</strong> (<em>bool</em><em>, </em><em>optional</em>) – Displays a summary of the function results. (def. False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Object of a SimpleITK image describing a mask (i.e. type ‘uint8’ with 0/1 values).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>SimpleITK Image</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#fredtools.cropImgToMask" title="fredtools.cropImgToMask"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cropImgToMask</span></code></a></dt><dd><p>Crop image to mask boundary.</p>
</dd>
<dt><a class="reference internal" href="dvhAnalyse.html#fredtools.getDVH" title="fredtools.getDVH"><code class="xref py py-obj docutils literal notranslate"><span class="pre">getDVH</span></code></a></dt><dd><p>calculate DVH for structure</p>
</dd>
</dl>
</div>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>1. the functionality of <code class="docutils literal notranslate"><span class="pre">gatetools</span></code> package has been tested but it turned
out that it does not consider holes and detached structures. Therefore a new
approach has been implemented</p>
<p>2. Although the implementation exploits multiple CPU computation using numba
functionality, it would be recommended to move this functionality to GPU. Such implementation
is described in <a class="footnote-reference brackets" href="#id5" id="id2">1</a> but has not been tested yet.</p>
<p>3. Two methods of mapping voxels are available of are available: ‘allinside’, which
maps the voxels which are all inside the contour (including voxel size and edges),
and ‘centreInside’ (default method), which maps only the centre of the voxels.
Obviously, the ‘centreInside’ method is faster. On the other hand it usually calculates
the volume of the structure slightly larger than the real volume. Contrary, the ‘allinside’
method should always calculate smaller volume and should converge to the real volume while
the <cite>img</cite> resolution increases.</p>
<p>4. Two algorithms of mapping are available: ‘matplotlib’, which utilizes the
matplotlib.path.Path.contains_points functionality, and ‘smparallel’, which exploits
the algorithm described in <a class="footnote-reference brackets" href="#id5" id="id3">1</a> (search for ‘Comparison of different methods’) along with numba functionality of
multiprocessing <a class="footnote-reference brackets" href="#id6" id="id4">2</a> (default algorithm). The ‘matplotlib’
algorithm calculates on a single CPU thread and is the slowest but it does not require
any specific modules to be installed (basically the matplotlib) and should work on any platform.
The ‘smparallel’ has been adapted from the above mentioned conversations and no significant
changes have been made. Nevertheless, it has been tested against clinical Treatment Planning System
(Varian Eclipse 15.6) and the standard ‘matplotlib’ method, showing no significant difference.
Because, the ‘smparallel’ method utilizes numba module to speed and parallelise the computation,
it might happen that it will not work on all platforms. Basically, the numba and tbb packages
should be installed, but no testing on other platforms has been done.</p>
<p>5. The mapping is done for each contour separately and based on the direction (CW or CCW)
of the contour it is treated as an inclusive (mask, CW) or exclusive (hole, CCW) contour.
The mapping of each contour is done in 2D, meaning slice by slice. The resulting image has
the voxel size and shape the same as the input <cite>img</cite> in X and Y directions. The voxel size
in Z direction is calculated based on the contour slice distances, taking into account
gaps, holes and detached contours. The shape of the image in Z direction is equal to
the contour boundings in Z direction, enlarged by 1 px (<code class="docutils literal notranslate"><span class="pre">sliceAddNo</span></code> parameter). Such
image mask, is then resampled to the frame of reference of the input <cite>img</cite>. In fact,
the resampling is applied only to Z direction, because the frame of reference of X and Y
directions are the same as the input <cite>img</cite>.</p>
<ol class="arabic simple" start="6">
<li><p>It is also described on</p></li>
</ol>
</div>
<div class="admonition-references admonition">
<p class="admonition-title">References</p>
<dl class="footnote brackets">
<dt class="label" id="id5"><span class="brackets">1</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id2">2</a>,<a href="#id3">3</a>)</span></dt>
<dd><p><a class="reference external" href="https://stackoverflow.com/questions/36399381/whats-the-fastest-way-of-checking-if-a-point-is-inside-a-polygon-in-python">https://stackoverflow.com/questions/36399381/whats-the-fastest-way-of-checking-if-a-point-is-inside-a-polygon-in-python</a></p>
</dd>
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id4">2</a></span></dt>
<dd><p><a class="reference external" href="http://numba.pydata.org/">http://numba.pydata.org/</a></p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fredtools.cropImgToMask">
<span class="sig-prename descclassname"><span class="pre">fredtools.</span></span><span class="sig-name descname"><span class="pre">cropImgToMask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imgMask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">displayInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fredtools.cropImgToMask" title="Permalink to this definition">¶</a></dt>
<dd><p>Crop image to mask boundary.</p>
<p>The function calculates the boundaries of the <cite>imgMask</cite> defined
as an instance of a SimpleITK image object describing a mask
(i.e. type uint8 and only 0/1 values) and crops the <cite>img</cite> defined
as an instance of a SimpleITK image object to these boundaries. The boundaries
mean here the most extreme positions of positive values of the mask in
each direction. The function exploits SimpleITK.Crop routine.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>SimpleITK Image</em>) – Object of a SimpleITK image.</p></li>
<li><p><strong>imgMask</strong> (<em>SimpleITK Image</em>) – Object of a SimpleITK image describing a mask.</p></li>
<li><p><strong>displayInfo</strong> (<em>bool</em><em>, </em><em>optional</em>) – Displays a summary of the function results. (def. False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Object of a SimpleITK image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>SimpleITK Image</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#fredtools.mapStructToImg" title="fredtools.mapStructToImg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mapStructToImg</span></code></a></dt><dd><p>mapping a structure to image to create a mask.</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fredtools.setValueMask">
<span class="sig-prename descclassname"><span class="pre">fredtools.</span></span><span class="sig-name descname"><span class="pre">setValueMask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imgMask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outside</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">displayInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fredtools.setValueMask" title="Permalink to this definition">¶</a></dt>
<dd><p>Set value inside/outside mask.</p>
<p>The function sets those the values of the <cite>img</cite> defined as an instance of
a SimpleITK object which are inside or outside a mask described by the
<cite>imgMask</cite> defined as an instance of a SimpleITK object describing a mask
(i.e. type uint8 and only 0/1 values). The function is a simple wrapper for
SimpleITK.Mask routine.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>SimpleITK Image</em>) – Object of a SimpleITK image.</p></li>
<li><p><strong>imgMask</strong> (<em>SimpleITK Image</em>) – Object of a SimpleITK image describing a mask.</p></li>
<li><p><strong>value</strong> (<em>scalar</em>) – value to be set (the type will be mapped to the type of <cite>img</cite>).</p></li>
<li><p><strong>outside</strong> (<em>bool</em><em>, </em><em>optional</em>) – Determine if the values should be set outside the mask
(where mask values are equal to 0) or inside the mask
(where mask values are equal to 1) (def. True meaning
outside the mask)</p></li>
<li><p><strong>displayInfo</strong> (<em>bool</em><em>, </em><em>optional</em>) – Displays a summary of the function results. (def. False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Object of a SimpleITK image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>SimpleITK Image</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#fredtools.mapStructToImg" title="fredtools.mapStructToImg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mapStructToImg</span></code></a></dt><dd><p>mapping a structure to image to create a mask.</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fredtools.resampleImg">
<span class="sig-prename descclassname"><span class="pre">fredtools.</span></span><span class="sig-name descname"><span class="pre">resampleImg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spacing</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interpolation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'linear'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">splineOrder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">displayInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fredtools.resampleImg" title="Permalink to this definition">¶</a></dt>
<dd><p>Resample image to other voxel spacing.</p>
<p>The function resamples an image defined as an instance of a
SimpleITK image object to different voxel spacing using
a specified interpolation method. The assumption is that
the ‘low extent’ is not changed, i.e. the coordinates of
the corner of the first voxel preserved. The size of
the interpolated image is calculated to fit all the voxels’ centres
in the original image extent. The function exploits the
SimpleITK.Resample routine.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>SimpleITK Image</em>) – Object of a SimpleITK image.</p></li>
<li><p><strong>spacing</strong> (<em>array_like</em>) – New spacing in each direction. The length should be the same as the <cite>img</cite> dimension.</p></li>
<li><p><strong>interpolation</strong> (<em>{'linear'</em><em>, </em><em>'nearest'</em><em>, </em><em>'spline'}</em><em>, </em><em>optional</em>) – Determine the interpolation method. (def. ‘linear’)</p></li>
<li><p><strong>splineOrder</strong> (<em>int</em><em>, </em><em>optional</em>) – Order of spline interpolation. Must be in range 0-5. (def. 3)</p></li>
<li><p><strong>displayInfo</strong> (<em>bool</em><em>, </em><em>optional</em>) – Displays a summary of the function results. (def. False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Object of a SimpleITK image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>SimpleITK Image</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fredtools.sumImg">
<span class="sig-prename descclassname"><span class="pre">fredtools.</span></span><span class="sig-name descname"><span class="pre">sumImg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">imgs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">displayInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fredtools.sumImg" title="Permalink to this definition">¶</a></dt>
<dd><p>Sum list of images</p>
<p>The function sums an iterable (list, tuple, etc.) of images
defined as instances of a SimpleITK image object. The frame
of references of all images must be the same.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>imgs</strong> (<em>iterable</em>) – An iterable (list, tuple, etc.) of SimpleITK image objects.</p></li>
<li><p><strong>displayInfo</strong> (<em>bool</em><em>, </em><em>optional</em>) – Displays a summary of the function results. (def. False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Object of a SimpleITK image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>SimpleITK Image</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fredtools.createCylindricalMask">
<span class="sig-prename descclassname"><span class="pre">fredtools.</span></span><span class="sig-name descname"><span class="pre">createCylindricalMask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">startPoint</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">endPoint</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dimension</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">displayInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fredtools.createCylindricalMask" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a cylindrical Mask in image field of reference</p>
<p>The function creates a cylindrical mask with a given <cite>dimension</cite> and height
calculated from the starting and ending points of the cylinder in the frame of
references of an image defined as SimpleITK image object describing a 3D image.
Only 3D images are supported. The routine might be helpful for instance for making
a geometrical acceptance correction of a chamber used for Bragg peak measurements.
The routine was adapted from a GitHub repository: <a class="reference external" href="https://github.com/heydude1337/SimplePhantomToolkit/">https://github.com/heydude1337/SimplePhantomToolkit/</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>SimpleITK Image</em>) – Object of a SimpleITK 3D image.</p></li>
<li><p><strong>startPoint</strong> (<em>array_like</em>) – 3-element point describing the position of the centre of the first cylinder base.</p></li>
<li><p><strong>endPoint</strong> (<em>array_like</em>) – 3-element point describing the position of the centre of the second cylinder base.</p></li>
<li><p><strong>dimension</strong> (<em>scalar</em>) – Dimension of the cylinder.</p></li>
<li><p><strong>displayInfo</strong> (<em>bool</em><em>, </em><em>optional</em>) – Displays a summary of the function results. (def. False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Instance of a SimpleITK image object describing a mask (i.e. type ‘uint8’ with 0/1 values).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>SimpleITK Image</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#fredtools.mapStructToImg" title="fredtools.mapStructToImg"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mapStructToImg</span></code></a></dt><dd><p>mapping a structure to image to create a mask.</p>
</dd>
<dt><a class="reference internal" href="#fredtools.setValueMask" title="fredtools.setValueMask"><code class="xref py py-obj docutils literal notranslate"><span class="pre">setValueMask</span></code></a></dt><dd><p>setting values of the image inside/outside a mask.</p>
</dd>
<dt><a class="reference internal" href="#fredtools.cropImgToMask" title="fredtools.cropImgToMask"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cropImgToMask</span></code></a></dt><dd><p>crop an image to mask.</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fredtools.getImgBEV">
<span class="sig-prename descclassname"><span class="pre">fredtools.</span></span><span class="sig-name descname"><span class="pre">getImgBEV</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">isocentrePosition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gantryAngle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">couchAngle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">defaultPixelValue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interpolation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'linear'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">splineOrder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">displayInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fredtools.getImgBEV" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform an image to Beam’s Eye View (BEV).</p>
<p>The function transforms a 3D image defined as a SimpleITK 3D image object to
the Beam’s Eye View (BEV) based on the given isocentre position,
gantry angle and couch rotation, using defined interpolation method.
The BEV Field of Reference (FOR) means that the Z+ direction is along the field
(along the beam of relative position [0,0]) and X/Y positions are consistend with
the DICOM and FRED Monte Carlo definitions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>img</strong> (<em>SimpleITK 3D Image</em>) – Object of a SimpleITK 3D image.</p></li>
<li><p><strong>isocentrePosition</strong> (<em>array_like</em><em>, </em><em>(</em><em>3x1</em><em>)</em>) – Position of the isocentre with respect to the <cite>img</cite> FOR.</p></li>
<li><p><strong>gantryAngle</strong> (<em>scalar</em>) – Rotation of the gantry around the isocentre position in [deg].</p></li>
<li><p><strong>couchAngle</strong> (<em>scalar</em>) – Rotation of the couch around the isocentre position in [deg].</p></li>
<li><p><strong>defaultPixelValue</strong> (<em>'auto'</em><em> or </em><em>scalar</em><em>, </em><em>optional</em>) – The value to fill the voxels with, outside the original <cite>img</cite>.
If ‘auto’, then the value will be calculated automatically as the
minimum value of the <cite>img</cite>. (def. ‘auto’)</p></li>
<li><p><strong>interpolation</strong> (<em>{'linear'</em><em>, </em><em>'nearest'</em><em>, </em><em>'spline'}</em><em>, </em><em>optional</em>) – Determine the interpolation method. (def. ‘linear’)</p></li>
<li><p><strong>splineOrder</strong> (<em>int</em><em>, </em><em>optional</em>) – Order of spline interpolation. Must be in range 0-5. (def. 3)</p></li>
<li><p><strong>displayInfo</strong> (<em>bool</em><em>, </em><em>optional</em>) – Displays a summary of the function results. (def. False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Object of a transformed SimpleITK 3D image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>SimpleITK 3D Image</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>The basic workflow follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>translate the image to the isocentre so to have the isocentre at zero position,</p></li>
<li><p>rotate the couch around the isocentre,</p></li>
<li><p>rotate the gantry around the isocentre,</p></li>
<li><p>rotate and flip image to get BEV.</p></li>
</ol>
</div></blockquote>
<p>Note that the isocentre of the transformed image is at the zero point.</p>
<p>Note that the isocentre defined in the delivery sequence of the FRED rtplan is
a negative isocentre defined in the DICOM RN plan, the couch rotation defined
in the delivery sequence of the FRED rtplan is a negative couch rotation defined
in the DICOM RN plan, but the gantry rotation defined in the delivery sequence
of the FRED rtplan is equal to the gantry rotation the DICOM RN plan.</p>
</div>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="displayImage.html" class="btn btn-neutral float-right" title="Display Image" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="GettingSubimage.html" class="btn btn-neutral float-left" title="Getting Subimage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright FRED collaboration.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>